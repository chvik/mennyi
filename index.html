<meta charset="utf-8">
<style>
html {
  background-color: #458;
  font-family: sans-serif;
  zoom: 1.5;
  font-size: 120%;
}
input[type=range] {
  font-size: 100%;
  width: 200px;
}
#szint, #valasz {
  font-size: 200%;
}
#valasz {
  padding: 5px 10px;
  width: 20vw;
}
#hangszoro {
  font-size: 200%;
  float: right;
  display: none;
  animation: pulse 1s infinite ease;
}
button {
  font-size: 100%;
  padding: 10px 30px;
  border-radius: 10px;
}
body {
  margin: 30px auto;
  width: 25vw;
  padding: 50px;
  border-radius: 50px;
  background-color: white;
  box-shadow: 0 10px 10px #0004;
}
@keyframes pulse {
  0% { transform: scale(1.1) }
  15% { transform: scale(1.15) }
  35% { transform: scale(1.1)}
  70% { transform: scale(1.15) }
  90% { transform: scale(1.1) }
  100% { transform: scale(1.1) }
}
</style>

<p><a href="https://github.com/darabos/mennyi">
  <img src="https://github.com/favicon.ico" width="20" style="float: right;"></a>
<p><span id="szint"></span>. szint
<p>Sebess√©g: <input type="range" id="sebesseg" min="0.5" max="2" value="1" step="any">
<select id="nyelv"></select>
<label><input type="checkbox" id="szorzas" />Szorz√°s</label>
<p><button onclick="start()">Start ‚èé</button><span id="hangszoro">üîä</span>
<p><input type="number" id="valasz">


<script>
speechSynthesis.onvoiceschanged = function() {};
const LANGUAGES = {
  'Magyar': {
    lang: 'hu', prompt: 'Mennyi', plus: 'meg', times: n => 'sz' + 'xe√∂oe√∂oeoe'[n] + 'r',
    numbers: ['egy', 'kett≈ë', 'h√°rom', 'n√©gy', '√∂t', 'hat', 'h√©t', 'nyolc', 'kilenc'],
    yes: ['Igen.', 'Igen.', 'Igen.', 'Igen.', '√çgy van.'],
    no: ['Nem.', 'Nem.', 'Nem.', 'Nem.', 'Jaj, nem.'],
  },
  'Angol': {
    lang: 'en', prompt: 'What is', plus: 'plus', times: 'times',
    numbers: ['one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'],
    yes: ['Yes.', 'Correct.', 'Yeah.', 'Indeed.', 'Right.'],
    no: ['No.', 'No.', 'No.', 'No.', 'Nope.', 'Sorry.'],
  },
  '≈∞rl√©ny': {
    lang: 'hu', prompt: 'Mennyi', plus: 'meg', times: n => 'sz' + 'xooeoeoooo'[n] + 'r',
    numbers: ['ong', 'bong', 'k√©', 'melo', 'gik', 'lekka', 'larp', 'donk', 'bedong'],
    yes: ['Igen.', 'Igen.', 'Igen.', 'Igen.', '√çgy van.'],
    no: ['Nem.', 'Nem.', 'Nem.', 'Nem.', 'Jaj, nem.'],
  },
  'Csibe': {
    lang: 'hu', prompt: 'Mennyi', plus: 'meg', times: 'szer',
    numbers: ['csip', 'csipcsip', 'csipcsipcsip', 'csipcsipcsipcsip', 'csirip', 'csipcsirip', 'csipcsipcsirip', 'csipcsipcsipcsirip', 'csipcsipcsipcsipcsirip'],
    yes: ['Igen.', 'Igen.', 'Igen.', 'Igen.', '√çgy van, kukurik√∫.'],
    no: ['Nem.', 'Nem.', 'Nem.', 'Nem.', 'Csip, nem.'],
  },
  'Jap√°n': {
    lang: 'ja', prompt: '', plus: '„Åü„Åô', times: '„Åã„Åë„Çã', ending: '„Å®„ÅØ‰Ωï„Åß„Åô„ÅãÔºü',
    numbers: ['1', '2', '3', '4', '5', '6', '7', '8', '9'],
    yes: ['„ÅØ„ÅÑ„ÄÇ', '„ÅØ„ÅÑ„ÄÇ', '„ÅØ„ÅÑ„ÄÇ', '„ÅØ„ÅÑ„ÄÇ', '„ÅØ„ÅÑ„ÄÅÁ¢∫„Åã„Å´„ÄÇ'],
    no: ['„ÅÑ„ÅÑ„Åà„ÄÇ', '„ÅÑ„ÅÑ„Åà„ÄÇ', '„ÅÑ„ÅÑ„Åà„ÄÇ', '„ÅÑ„ÅÑ„Åà„ÄÇ', '„Å®„Çì„Åß„ÇÇ„Å™„ÅÑ„ÄÇ'],
  },
  'H√≥napok': {
    lang: 'hu', prompt: 'Mennyi', plus: 'meg', times: n => 'sz' + 'xooooooooeeee'[n] + 'r',
    numbers: 'janu√°r febru√°r m√°rcius √°prilis m√°jus j√∫nius j√∫lius augusztus szeptember okt√≥ber november december'.split(' '),
    yes: ['Igen.', 'Igen.', 'Igen.', 'Igen.', '√çgy van.', 'T√∂k√©letes.'],
    no: ['Nem.', 'Nem.', 'Nem.', 'Nem.', 'Jaj, nem.', 'T√∂k√©letesen rossz.'],
  },
}
for (const l in LANGUAGES) {
  nyelv.innerHTML += `<option value="${l}">${l}</option>`;
}
let level = 2;
let answer = '';
szint.textContent = level;
function newTask(level) {
  const l = LANGUAGES[nyelv.value];
  let answer, last, mult;
  const words = [];
  for (let i = 0; i < level; ++i) {
    const n = Math.floor(Math.random() * l.numbers.length) + 1;
    if (!answer) {
      words.push(l.numbers[n-1]);
      answer = n;
      mult = n;
    } else if (szorzas.checked && Math.random() < 0.5) {
      words.push(typeof l.times === 'string' ? l.times : l.times(last));
      words.push(l.numbers[n-1]);
      answer += mult * (n - 1);
      mult *= n;
    } else {
      words.push(l.plus);
      words.push(l.numbers[n-1]);
      answer += n;
      mult = n;
    }
    last = n;
  }
  const text = l.prompt + ' ' + words.join(' ') + (l.ending || '?');
  return {text, answer};
}
let task;
function start() {
  task = newTask(level);
  console.log(task.text);
  answer = '';
  valasz.value = '';
  valasz.style.backgroundColor = null;
  valasz.focus();
  say(task.text);
}
function say(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = LANGUAGES[nyelv.value].lang;
  u.rate = parseFloat(sebesseg.value);
  window.speechSynthesis.cancel();
  hangszoro.style.display = 'block';
  u.onend = function() { hangszoro.style.display = 'none'; };
  window.speechSynthesis.speak(u);
}
function sayRandom(options) {
  say(options[(Math.random() * options.length)|0]);
}
valasz.onkeypress = function(e) {
  e.preventDefault();
  if (e.key === 'Enter') {
    start();
  }
  if (valasz.style.backgroundColor) return;
  if (e.key >= '0' && e.key <= '9') {
    answer = answer + e.key;
    const correct = task.answer.toString();
    if (answer === correct) {
      valasz.style.backgroundColor = '#6f4';
      level += 1;
      szint.textContent = level;
      sayRandom(LANGUAGES[nyelv.value].yes);
    } else if (!correct.startsWith(answer)) {
      valasz.style.backgroundColor = '#f64';
      if (level > 2) {
        level -= 1;
        szint.textContent = level;
      }
      sayRandom(LANGUAGES[nyelv.value].no);
    }
    valasz.value = answer;
  }
}
</script>
